
# DXGI

  

DXGI(DirectX Graphics Infrastructure)는 Microsoft의 그래픽 API인 DirectX와 함께 사용하는 하위 시스템으로, 그래픽 하드웨어 및 리소스를 관리하고 제어하는 기능을 제공합니다. DXGI는 특히 Direct3D 애플리케이션에서 그래픽 어댑터, 디스플레이 장치, 스왑 체인 및 포맷 관리 등을 쉽게 할 수 있도록 설계되었습니다.

  
### 주요 기능

1.  **어댑터 및 출력 열거**:
    
    -   **어댑터 열거**: 시스템에 연결된 그래픽 카드(어댑터)를 열거하여 각각의 기능과 성능을 평가할 수 있습니다.
    -   **출력 열거**: 각 어댑터에 연결된 출력 장치(모니터 등)를 관리하고, 해상도 및 디스플레이 설정을 제어할 수 있습니다.
2.  **스왑 체인 관리**:
    
    -   **스왑 체인**: Direct3D 응용 프로그램이 화면에 렌더링하는 이미지를 관리합니다. 이는 이중 버퍼링 또는 삼중 버퍼링을 통해 부드러운 화면 전환을 제공합니다.
    -   **프레젠테이션 모드**: 전체 화면과 창 모드 전환을 포함하여, 스왑 체인에서 렌더링된 이미지를 화면에 표시하는 방식을 제어합니다.
3.  **포맷 및 해상도 지원**:
    
    -   **표면 포맷**: 텍스처, 렌더 타겟, 스왑 체인 등의 표면에 사용할 수 있는 다양한 데이터 포맷(DXGI_FORMAT)을 지원합니다.
    -   **해상도 및 비율 설정**: 디스플레이 장치에서 사용할 해상도와 종횡비 설정을 지원합니다.
4.  **멀티 GPU 및 다중 디스플레이 지원**:
    
    -   **다중 어댑터 사용**: 여러 개의 GPU를 사용하는 경우, DXGI를 통해 적절한 어댑터를 선택하고 사용하도록 관리할 수 있습니다.
    -   **다중 디스플레이 구성**: 여러 디스플레이를 사용하는 환경에서 해상도, 화면 배치 및 디스플레이 모드 등을 설정합니다.
5.  **디버그 및 성능 최적화 도구 지원**:
    
    -   DXGI는 디버그 레이어를 통해 오류를 추적하고 성능을 분석하는 도구를 지원하여 개발자가 애플리케이션의 성능을 최적화하는 데 도움을 줍니다.

  
### 사용 방식

	ThrowIfFailed(CreateDXGIFactory2(m_dxgiFactoryFlags, IID_PPV_ARGS(m_dxgiFactory.ReleaseAndGetAddressOf())));
-   **DXGI 팩토리 생성**: `CreateDXGIFactory2` 함수는 DXGI 팩토리 개체를 생성합니다. 이 팩토리는 어댑터(그래픽 카드)와 출력(모니터)과 같은 하드웨어 디바이스의 열거 및 관리에 필요한 기능을 제공합니다.
    
-   **Debugging 플래그 지원**: `CreateDXGIFactory2`는 `CreateDXGIFactory1`과 유사하지만, 추가적으로 `Flags` 매개변수를 통해 디버깅을 위한 플래그를 설정할 수 있습니다. 예를 들어, `DXGI_CREATE_FACTORY_DEBUG` 플래그를 사용하면 DXGI와 관련된 추가 디버그 정보를 얻을 수 있습니다.

	    ComPtr<IDXGIFactory6> factory6;
	    HRESULT hr = m_dxgiFactory.As(&factory6);
	    if (SUCCEEDED(hr))
	    {
As를 통해 안전한 다운캐스팅이 가능하므로 상위버전으로 정상적으로 캐스팅 됐다면 해당 버전에서 지원하는 기능을 사용합니다.

	typedef enum DXGI_GPU_PREFERENCE 
	{ 
		DXGI_GPU_PREFERENCE_UNSPECIFIED = 0, 	
		DXGI_GPU_PREFERENCE_MINIMUM_POWER, 
		DXGI_GPU_PREFERENCE_HIGH_PERFORMANCE 
	} ;
	
	for (UINT adapterIndex = 0;
    SUCCEEDED(factory6->EnumAdapterByGpuPreference(
        adapterIndex,
        DXGI_GPU_PREFERENCE_HIGH_PERFORMANCE,
        IID_PPV_ARGS(adapter.ReleaseAndGetAddressOf())));
    adapterIndex++)
연결된 그래픽 카드를 선호하는 타입을 기준으로 나열합니다. 6버전부터 지원되는 함수로 이전 버전에서는 **EnumAdapters1** 함수를 사용합니다.

	D3D12CreateDevice(adapter.Get(), m_d3dMinFeatureLevel, __uuidof(ID3D12Device), nullptr)
얻어온 Adapter로 CreateDevice를 수행해 Direct3D 12를 지원하는 지 확인합니다.

        // Create a descriptor for the swap chain.
        DXGI_SWAP_CHAIN_DESC1 swapChainDesc = {};
        swapChainDesc.Width = backBufferWidth;
        swapChainDesc.Height = backBufferHeight;
        swapChainDesc.Format = backBufferFormat;
        swapChainDesc.BufferUsage = DXGI_USAGE_RENDER_TARGET_OUTPUT;
        swapChainDesc.BufferCount = m_backBufferCount;
        swapChainDesc.SampleDesc.Count = 1;
        swapChainDesc.SampleDesc.Quality = 0;
        swapChainDesc.Scaling = DXGI_SCALING_STRETCH;
        swapChainDesc.SwapEffect = DXGI_SWAP_EFFECT_FLIP_DISCARD;
        swapChainDesc.AlphaMode = DXGI_ALPHA_MODE_IGNORE;
        swapChainDesc.Flags = (m_options & c_AllowTearing) ? DXGI_SWAP_CHAIN_FLAG_ALLOW_TEARING : 0u;

        DXGI_SWAP_CHAIN_FULLSCREEN_DESC fsSwapChainDesc = {};
        fsSwapChainDesc.Windowed = TRUE;

        // Create a swap chain for the window.
        ComPtr<IDXGISwapChain1> swapChain;
        ThrowIfFailed(m_dxgiFactory->CreateSwapChainForHwnd(
            m_commandQueue.Get(),
            m_window,
            &swapChainDesc,
            &fsSwapChainDesc,
            nullptr,
            swapChain.GetAddressOf()
            ));

        ThrowIfFailed(swapChain.As(&m_swapChain));

        // This class does not support exclusive full-screen mode and prevents DXGI from responding to the ALT+ENTER shortcut
        ThrowIfFailed(m_dxgiFactory->MakeWindowAssociation(m_window, DXGI_MWA_NO_ALT_ENTER));


`DXGI_SWAP_CHAIN_DESC1`  구조체를 사용하여 스왑 체인의 속성을 설정하고 생성합니다. 특히 `SwapEffect`는 화면 갱신 시 버퍼를 어떻게 처리할지를 결정합니다.